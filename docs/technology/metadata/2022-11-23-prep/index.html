<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="prep.sh and mlr # I am an inexperienced shell scripter, but this project provided opportunities to do some productive work with the shell. My workflow starts with running prep.sh, a script that takes 2 or 3 arguments and is explained below.
Shebang # I&rsquo;m on macOS, so my shebang line references zsh.
#! /usr/bin/env zsh Arguments # FILE=$(realpath $1) # full path to file name. must be pdf START=$2 # starting page of pdf file if [[ -n $3 ]] then FINISH=$3 # ending page of pdf file fi Here, I use realpath to take an argument like ."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="2. prep.sh and mlr"><meta property="og:description" content="prep.sh and mlr # I am an inexperienced shell scripter, but this project provided opportunities to do some productive work with the shell. My workflow starts with running prep.sh, a script that takes 2 or 3 arguments and is explained below.
Shebang # I&rsquo;m on macOS, so my shebang line references zsh.
#! /usr/bin/env zsh Arguments # FILE=$(realpath $1) # full path to file name. must be pdf START=$2 # starting page of pdf file if [[ -n $3 ]] then FINISH=$3 # ending page of pdf file fi Here, I use realpath to take an argument like ."><meta property="og:type" content="article"><meta property="og:url" content="https://blackerby.github.io/portfolio/docs/technology/metadata/2022-11-23-prep/"><meta property="article:section" content="docs"><title>2. prep.sh and mlr | William Blackerby: MLIS Portfolio</title><link rel=manifest href=/portfolio/manifest.json><link rel=icon href=/portfolio/favicon.png type=image/x-icon><link rel=stylesheet href=/portfolio/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin=anonymous><script defer src=/portfolio/flexsearch.min.js></script>
<script defer src=/portfolio/en.search.min.c248bd7cc8d5cd10074aa43ffc4e35b8f0c0b47d1fda9a0a35feedd02adcd979.js integrity="sha256-wki9fMjVzRAHSqQ//E41uPDAtH0f2poKNf7t0Crc2Xk=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/portfolio/><span>William Blackerby: MLIS Portfolio</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/portfolio/docs/philosophy/>Philosophy of LIS Practice</a></li><li><input type=checkbox id=section-426f539af5864fc342d2765a8b0cfb21 class=toggle>
<label for=section-426f539af5864fc342d2765a8b0cfb21 class="flex justify-between"><a href=/portfolio/docs/outcomes/>Program Learning Outcomes and Work Samples</a></label><ul><li><a href=/portfolio/docs/outcomes/articulate/>Critically Articulating the Philosophy, Principles, and Ethics of Library and Information Science</a><ul></ul></li><li><a href=/portfolio/docs/outcomes/evaluate/>Evaluating Technology-Mediated Access in Library and Information Services</a><ul></ul></li><li><a href=/portfolio/docs/outcomes/practice/>Practicing Principles of Social and Cultural Justice</a><ul></ul></li><li><a href=/portfolio/docs/outcomes/use/>Using Evidence to Inform Library and Information Practices</a><ul></ul></li></ul></li><li><a href=/portfolio/docs/resume/>Resume</a></li><li><input type=checkbox id=section-39dce656b4d24db3501949b7edf5cb43 class=toggle checked>
<label for=section-39dce656b4d24db3501949b7edf5cb43 class="flex justify-between"><a role=button>Technology</a></label><ul><li><input type=checkbox id=section-6489aba0bc74aaff9b095a3c6e1e7697 class=toggle checked>
<label for=section-6489aba0bc74aaff9b095a3c6e1e7697 class="flex justify-between"><a role=button>Metadata Workflow Series</a></label><ul><li><a href=/portfolio/docs/technology/metadata/2022-11-22-llc-workflow/>1. A High Level Metadata Workflow Overview</a></li><li><a href=/portfolio/docs/technology/metadata/2022-11-23-prep/ class=active>2. prep.sh and mlr</a></li><li><a href=/portfolio/docs/technology/metadata/2022-11-24-get-summaries/>3. get_summaries.py</a></li><li><a href=/portfolio/docs/technology/metadata/2022-11-25-emacs-workflow/>4. Emacs Workflow</a></li><li><a href=/portfolio/docs/technology/metadata/2022-11-25-cleanup/>5. cleanup.sh</a></li><li><a href=/portfolio/docs/technology/metadata/2022-12-04-meta-data-sette/>6. (meta)data(sette)</a></li></ul></li><li><a href=/portfolio/docs/technology/2022-12-02-senate-topic-modeling/>Visualizing Topics of 74th Congress Senate Bills and Joint Resolutions</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/portfolio/svg/menu.svg class=book-icon alt=Menu></label>
<strong>2. prep.sh and mlr</strong>
<label for=toc-control><img src=/portfolio/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#shebang>Shebang</a></li><li><a href=#arguments>Arguments</a></li><li><a href=#processing>Processing</a></li><li><a href=#wrapping-up>Wrapping up</a></li><li><a href=#pasting-metadata>Pasting metadata</a></li><li><a href=#up-next>Up next</a></li></ul></nav></aside></header><article class=markdown><h1 id=prepsh-and-mlr>prep.sh and mlr
<a class=anchor href=#prepsh-and-mlr>#</a></h1><p>I am an inexperienced shell scripter, but this project provided opportunities to do some productive work with the shell. My workflow starts with running <code>prep.sh</code>, a script that takes 2 or 3 arguments and is explained below.</p><h2 id=shebang>Shebang
<a class=anchor href=#shebang>#</a></h2><p>I&rsquo;m on macOS, so my shebang line references zsh.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#75715e>#! /usr/bin/env zsh
</span></span></span></code></pre></div><h2 id=arguments>Arguments
<a class=anchor href=#arguments>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>FILE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>realpath $1<span style=color:#66d9ef>)</span> <span style=color:#75715e># full path to file name. must be pdf</span>
</span></span><span style=display:flex><span>START<span style=color:#f92672>=</span>$2 <span style=color:#75715e># starting page of pdf file</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -n $3 <span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>	FINISH<span style=color:#f92672>=</span>$3 <span style=color:#75715e># ending page of pdf file</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p>Here, I use <code>realpath</code> to take an argument like <code>../../74.2.pdf</code> and expand it to its full path. The first argument, <code>$1</code>, is should be a path to a PDF file. <code>$2</code> should be the page the python script begins processing from, and <code>$3</code> should be the last page it processes.</p><h2 id=processing>Processing
<a class=anchor href=#processing>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#75715e># pull metadata into csv and write summaries out to text files</span>
</span></span><span style=display:flex><span><span style=color:#75715e># named following this schema: {congress}_{session}_{bill type}_{bill number}.txt</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -n $FINISH <span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>	python3 get_summaries.py $FILE $START $FINISH
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>	python3 get_summaries.py $FILE $START
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p>If there is no <code>$3</code>, no worries: we just pass the file path and the start page to the python script.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#75715e># get file&#39;s name for name of new directory and iteration purposes</span>
</span></span><span style=display:flex><span>FILE_BASENAME<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>basename $FILE .pdf<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p>Here, I use <code>basename</code> with the name of the file and the extension <code>.pdf</code> to get the basename of the file the script is processing. This will be used to name the directories created by the script.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#75715e># make new directory and move generated files into it</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -n $FINISH <span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>	NEW_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>FILE_BASENAME<span style=color:#e6db74>}</span><span style=color:#e6db74>_</span><span style=color:#e6db74>${</span>START<span style=color:#e6db74>}</span><span style=color:#e6db74>_</span><span style=color:#e6db74>${</span>FINISH<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>	NEW_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>FILE_BASENAME<span style=color:#e6db74>}</span><span style=color:#e6db74>_</span><span style=color:#e6db74>${</span>START<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p>Above, we name the directory that the files generated by the script will be moved into.</p><p>Manual processing of the bill summaries pointed out some common OCR errors, so below I run a <code>sed</code> script to deal with some of those.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#66d9ef>for</span> f in *.<span style=color:#f92672>{</span>txt,csv<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>	gsed -f common_errors.sed -i $f
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><p>Here&rsquo;s what that script looks like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sed data-lang=sed><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\bJudiciarv\b</span>/<span style=color:#e6db74>Judiciary</span>/<span style=color:#66d9ef>ig</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\bTvdings\b</span>/<span style=color:#e6db74>Tydings</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\bbv\b</span>/<span style=color:#e6db74>by</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\banv\b</span>/<span style=color:#e6db74>any</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\bdenved\b</span>/<span style=color:#e6db74>derived</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\bm\b</span>/<span style=color:#e6db74>in</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\bpiopose\b</span>/<span style=color:#e6db74>propose</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\bwhioh\b</span>/<span style=color:#e6db74>which</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\beto.\b</span>/<span style=color:#e6db74>etc.</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\bwit inn\b</span>/<span style=color:#e6db74>within</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\bwrorks\b</span>/<span style=color:#e6db74>works</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\bLnited\b</span>/<span style=color:#e6db74>United</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\bsolelv\b</span>/<span style=color:#e6db74>solely</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\blavs\b</span>/<span style=color:#e6db74>lays</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\bArmv\b</span>/<span style=color:#e6db74>Army</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\biniured\b</span>/<span style=color:#e6db74>injured</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\bDedares\b</span>/<span style=color:#e6db74>Declares</span>/<span style=color:#66d9ef>ig</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\bcrcp\b</span>/<span style=color:#e6db74>crop</span>/<span style=color:#66d9ef>ig</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\bWilev\b</span>/<span style=color:#e6db74>Wiley</span>/<span style=color:#66d9ef>ig</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>\bdomestio\b</span>/<span style=color:#e6db74>domestic</span>/<span style=color:#66d9ef>ig</span>
</span></span></code></pre></div><p>Simple stuff, but it saves some time.</p><p>The OCR preserved the typesetting of the lines in the original document, so I run another <code>sed</code> script to make the lines flow and to replace some of the entities the script brings in and normalize some of the punctuation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#66d9ef>for</span> f in *.txt
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>	gsed -i.bak -Ez -f clean_lines.sed $f
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><p>Here&rsquo;s that script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sed data-lang=sed><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>- \n</span>//<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>(\.:) \n</span>/<span style=color:#e6db74>\1\n\n</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>([^.:] )\n</span>/<span style=color:#e6db74>\1</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>(‘‘|’’|“|”)</span>/<span style=color:#e6db74>&#34;</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>[‘’]</span>/<span style=color:#e6db74>&#39;</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>-?— ?</span>/<span style=color:#e6db74>--</span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>■</span>//<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74> (#|\.+) </span>/<span style=color:#e6db74> </span>/<span style=color:#66d9ef>g</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>(\w\.)\.+</span>/<span style=color:#e6db74>\1.</span>/<span style=color:#66d9ef>g</span>
</span></span></code></pre></div><h2 id=wrapping-up>Wrapping up
<a class=anchor href=#wrapping-up>#</a></h2><p>Finally, I move the files generated by the python script into a directory named after the file and page number(s) the being procssed and then copy that directory and its contents into a backup directory.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>mkdir $NEW_DIR
</span></span><span style=display:flex><span>mv $FILE_BASENAME*.??? $NEW_DIR
</span></span><span style=display:flex><span>cp -R $NEW_DIR <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>NEW_DIR<span style=color:#e6db74>}</span><span style=color:#e6db74>.bak&#34;</span>
</span></span></code></pre></div><h2 id=pasting-metadata>Pasting metadata
<a class=anchor href=#pasting-metadata>#</a></h2><p>The data entry for this workflow happens in Google Sheets, so I use <a href=https://miller.readthedocs.io>Miller</a> to convert the generated CSV file to TSV for easier pasting into Sheets. I could probably go back and have the script spit out TSV instead of CSV.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>mlr --c2t --headerless-csv-output cat 74_2_<span style=color:#f92672>{</span>PAGE_NUM<span style=color:#f92672>}</span>.csv | pbcopy
</span></span></code></pre></div><p><code>--c2t</code> tells Miller to convert CSV to TSV, and <code>--headerless-csv-output</code> ignores the first line of the file.</p><h2 id=up-next>Up next
<a class=anchor href=#up-next>#</a></h2><p>As you can probably tell, this script is really just a harness for the <code>get_summaries.py</code> script that does the bulk of the work. That script will be explained in the next post.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#shebang>Shebang</a></li><li><a href=#arguments>Arguments</a></li><li><a href=#processing>Processing</a></li><li><a href=#wrapping-up>Wrapping up</a></li><li><a href=#pasting-metadata>Pasting metadata</a></li><li><a href=#up-next>Up next</a></li></ul></nav></div></aside></main></body></html>