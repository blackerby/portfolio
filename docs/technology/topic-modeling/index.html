<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Visualizing Topics of 74th Congress Senate Bills and Joint Resolutions # ðŸ‘‰ This code is available to experiment with on Binder in a notebook with the filename tmr.ipynb. Be sure to check out the ner_mapping.ipynb notebook as well, in which I create a heatmap of states mentioned in Senate bills and joint resolutions during the 74th Congress.
In LS 562: Digital Libraries, we studied the application of machine learning tools to text analysis problems."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Visualizing Topics of 74th Congress Senate Bills and Joint Resolutions"><meta property="og:description" content="Visualizing Topics of 74th Congress Senate Bills and Joint Resolutions # ðŸ‘‰ This code is available to experiment with on Binder in a notebook with the filename tmr.ipynb. Be sure to check out the ner_mapping.ipynb notebook as well, in which I create a heatmap of states mentioned in Senate bills and joint resolutions during the 74th Congress.
In LS 562: Digital Libraries, we studied the application of machine learning tools to text analysis problems."><meta property="og:type" content="article"><meta property="og:url" content="https://blackerby.github.io/portfolio/docs/technology/topic-modeling/"><meta property="article:section" content="docs"><title>Visualizing Topics of 74th Congress Senate Bills and Joint Resolutions | Blackerby Portfolio</title><link rel=manifest href=/portfolio/manifest.json><link rel=icon href=/portfolio/favicon.png type=image/x-icon><link rel=stylesheet href=/portfolio/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin=anonymous><script defer src=/portfolio/flexsearch.min.js></script>
<script defer src=/portfolio/en.search.min.593a7877f7e1a8e7afee625f819464424549e5f90858e73b77bd1e44cdae2d94.js integrity="sha256-WTp4d/fhqOev7mJfgZRkQkVJ5fkIWOc7d70eRM2uLZQ=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/portfolio/><span>Blackerby Portfolio</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-426f539af5864fc342d2765a8b0cfb21 class=toggle>
<label for=section-426f539af5864fc342d2765a8b0cfb21 class="flex justify-between"><a href=/portfolio/docs/outcomes/>Outcomes</a></label><ul><li><a href=/portfolio/docs/outcomes/articulate/>Articulate</a><ul></ul></li><li><a href=/portfolio/docs/outcomes/evaluate/>Evaluate</a><ul></ul></li><li><a href=/portfolio/docs/outcomes/practice/>Practice</a><ul></ul></li><li><a href=/portfolio/docs/outcomes/use/>Use</a><ul></ul></li></ul></li><li><a href=/portfolio/docs/philosophy/>Philosophy</a></li><li><a href=/portfolio/docs/resume/>Resume</a></li><li><input type=checkbox id=section-39dce656b4d24db3501949b7edf5cb43 class=toggle checked>
<label for=section-39dce656b4d24db3501949b7edf5cb43 class="flex justify-between"><a role=button>Technology</a></label><ul><li><input type=checkbox id=section-6489aba0bc74aaff9b095a3c6e1e7697 class=toggle>
<label for=section-6489aba0bc74aaff9b095a3c6e1e7697 class="flex justify-between"><a role=button>Metadata Workflow Series</a></label><ul><li><a href=/portfolio/docs/technology/metadata/2022-11-22-llc-workflow/>1. A High Level Metadata Workflow Overview</a></li><li><a href=/portfolio/docs/technology/metadata/2022-11-23-prep/>2. prep.sh and mlr</a></li><li><a href=/portfolio/docs/technology/metadata/2022-11-24-get-summaries/>3. get_summaries.py</a></li><li><a href=/portfolio/docs/technology/metadata/2022-11-25-emacs-workflow/>4. Emacs Workflow</a></li><li><a href=/portfolio/docs/technology/metadata/2022-11-25-cleanup/>5. cleanup.sh</a></li><li><a href=/portfolio/docs/technology/metadata/2022-12-04-meta-data-sette/>6. (meta)data(sette)</a></li></ul></li><li><a href=/portfolio/docs/technology/topic-modeling/ class=active>Visualizing Topics of 74th Congress Senate Bills and Joint Resolutions</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/portfolio/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Visualizing Topics of 74th Congress Senate Bills and Joint Resolutions</strong>
<label for=toc-control><img src=/portfolio/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#setting-up>Setting Up</a><ul><li><a href=#the-necessary-libraries>The Necessary Libraries</a></li><li><a href=#initializing-spacy>Initializing spaCy</a></li><li><a href=#load-dataset>Load dataset</a></li></ul></li><li><a href=#preprocessing>Preprocessing</a><ul><li><a href=#spacy>spaCy</a></li><li><a href=#getting-the-words-we-want>Getting the words we want</a></li></ul></li><li><a href=#topic-modeling>Topic Modeling</a><ul><li><a href=#a-document-feature-matrix>A document feature matrix</a></li><li><a href=#visualization>Visualization</a></li></ul></li><li><a href=#wrapping-up>Wrapping up</a></li></ul></nav></aside></header><article class=markdown><h1 id=visualizing-topics-of-74th-congress-senate-bills-and-joint-resolutions>Visualizing Topics of 74th Congress Senate Bills and Joint Resolutions
<a class=anchor href=#visualizing-topics-of-74th-congress-senate-bills-and-joint-resolutions>#</a></h1><p><blockquote class="book-hint info"><p>ðŸ‘‰ This code is available to experiment with on Binder in a notebook with the filename <code>tmr.ipynb</code>. Be sure to check out the <code>ner_mapping.ipynb</code> notebook as well, in which I create a heatmap of states mentioned in Senate bills and joint resolutions during the 74th Congress.</p><p><a href=https://mybinder.org/v2/gh/blackerby/ls562project/b4ddf1c5a51b7d206f8933afb90210ab3ceb19a0><img src=https://mybinder.org/badge_logo.svg alt=Binder></a></p></blockquote>In LS 562: Digital Libraries, we studied the application of machine learning tools to text analysis problems. For practice, I decided to apply one of those tools, topic modeling, to the corpus of 74th Congress Senate bills and join resolutions I processed during my remote metadata internship with the Law Library of Congress.</p><h2 id=setting-up>Setting Up
<a class=anchor href=#setting-up>#</a></h2><h3 id=the-necessary-libraries>The Necessary Libraries
<a class=anchor href=#the-necessary-libraries>#</a></h3><p>Below, we load the libraries this project uses into my work environment. <code>tidyverse</code>, <code>tidytext</code>, and <code>ggplot2</code> are pretty well know inhabitants of the R Tidyverse, so I won&rsquo;t explain them here. <a href=https://www.structuraltopicmodel.com/>stm</a> is the package used in this project for topic modeling. <a href=https://github.com/cpsievert/LDAvis>LDAvis</a> is the tool we will use to visualize the <a href=https://en.wikipedia.org/wiki/Latent_Dirichlet_allocation>LDA</a> model applied to Senate bill corpus. <a href=http://quanteda.io/>quanteda</a> is a text analysis library, and <a href=https://spacyr.quanteda.io/index.html>spacyr</a> is an R wrapper for the Python natural language processing library <a href=https://spacy.io/>spaCy</a>. <a href=https://github.com/ropensci/gistr>gistr</a> is necessary for publishing the visualization to the web.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#a6e22e>library</span>(tidyverse)
</span></span><span style=display:flex><span><span style=color:#a6e22e>library</span>(tidytext)
</span></span><span style=display:flex><span><span style=color:#a6e22e>library</span>(ggplot2)
</span></span><span style=display:flex><span><span style=color:#a6e22e>library</span>(stm)
</span></span><span style=display:flex><span><span style=color:#a6e22e>library</span>(LDAvis)
</span></span><span style=display:flex><span><span style=color:#a6e22e>library</span>(quanteda)
</span></span><span style=display:flex><span><span style=color:#a6e22e>library</span>(spacyr)
</span></span><span style=display:flex><span><span style=color:#a6e22e>library</span>(gistr)
</span></span></code></pre></div><h3 id=initializing-spacy>Initializing spaCy
<a class=anchor href=#initializing-spacy>#</a></h3><p>Below, we initialize spaCy with its built-in English language model.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#a6e22e>spacy_initialize</span>(model <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;en_core_web_sm&#34;</span>)
</span></span></code></pre></div><h3 id=load-dataset>Load dataset
<a class=anchor href=#load-dataset>#</a></h3><p>The data we will use is available for download as a CSV file from a simple API created using Datasette. I have crafted a SQL query to get just the data that we need. This query will return a table containing each bill summary&rsquo;s unique ID in the database and its text.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span>data <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>read.csv</span>(<span style=color:#e6db74>&#34;https://llc.herokuapp.com/summaries.csv?sql=select%0D%0A++rowid%2C%0D%0A++content_text%0D%0Afrom%0D%0A++files%0D%0Awhere%0D%0A++%22path%22+like+%2274_2_s%25%22%0D%0Aorder+by%0D%0A++path&amp;_size=max&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>head</span>(data)
</span></span></code></pre></div><h2 id=preprocessing>Preprocessing
<a class=anchor href=#preprocessing>#</a></h2><p>With the environment set up and the data acquired, we can start massaging the data into the shape the topic modeling algorithm needs.</p><h3 id=spacy>spaCy
<a class=anchor href=#spacy>#</a></h3><p>First, we put the text of all the bills we downloaded into one big string which we then use spaCy to parse.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span>text <span style=color:#f92672>&lt;-</span> data<span style=color:#f92672>$</span>content_text <span style=color:#f92672>%&gt;%</span> <span style=color:#a6e22e>str_c</span>()
</span></span><span style=display:flex><span>parsed_text <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>spacy_parse</span>(text, lemma <span style=color:#f92672>=</span> <span style=color:#66d9ef>TRUE</span>, entity <span style=color:#f92672>=</span> <span style=color:#66d9ef>TRUE</span>, nounphrase <span style=color:#f92672>=</span> <span style=color:#66d9ef>TRUE</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>head</span>(parsed_text)
</span></span></code></pre></div><h3 id=getting-the-words-we-want>Getting the words we want
<a class=anchor href=#getting-the-words-we-want>#</a></h3><p>Next, we reduce the corpus to tokens that have been <a href=https://en.wikipedia.org/wiki/Part-of-speech_tagging>part-of-speech tagged</a> as proper nouns, verbs, nouns, adjectives, and adverbs. The part-of-speech tagging isn&rsquo;t perfect, so we remove tokens tagged as those parts of speech that we know aren&rsquo;t, actually. Finally, make all of the lemmas lowercase and create the <code>word</code> column.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span>tokens <span style=color:#f92672>&lt;-</span> parsed_text <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>filter</span>(pos <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;PROPN&#34;</span> <span style=color:#f92672>|</span> pos <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;VERB&#34;</span> <span style=color:#f92672>|</span> pos <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;NOUN&#34;</span> <span style=color:#f92672>|</span> pos <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ADJ&#34;</span> <span style=color:#f92672>|</span> pos <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ADV&#34;</span>) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>filter</span>(lemma <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;.&#34;</span> <span style=color:#f92672>&amp;</span> lemma <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;Mr.&#34;</span> <span style=color:#f92672>&amp;</span> <span style=color:#a6e22e>str_detect</span>(lemma, <span style=color:#e6db74>&#34;^\\w\\.?$&#34;</span>, negate <span style=color:#f92672>=</span> <span style=color:#66d9ef>TRUE</span>)) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>filter</span>(lemma <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;Â§&#34;</span>) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mutate</span>(word <span style=color:#f92672>=</span> <span style=color:#a6e22e>tolower</span>(lemma))
</span></span></code></pre></div><p>Next we get rid of <a href=https://en.wikipedia.org/wiki/Stop_word>stop words</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#a6e22e>data</span>(<span style=color:#e6db74>&#34;stop_words&#34;</span>)
</span></span><span style=display:flex><span>tokens <span style=color:#f92672>&lt;-</span> tokens <span style=color:#f92672>%&gt;%</span> <span style=color:#a6e22e>anti_join</span>(stop_words)
</span></span></code></pre></div><p>And now we can take a quick look at the tokens that appear more than 100 times in the bill summaries.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span>tokens <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>count</span>(word, sort <span style=color:#f92672>=</span> <span style=color:#66d9ef>TRUE</span>) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>filter</span>(n <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>100</span>) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mutate</span>(word <span style=color:#f92672>=</span> <span style=color:#a6e22e>reorder</span>(word, n)) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ggplot</span>(<span style=color:#a6e22e>aes</span>(n, word)) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>geom_col</span>() <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>labs</span>(y <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>)
</span></span></code></pre></div><p>The names of months show up a lot, but they won&rsquo;t contribute meaningfully to the topic model. Let&rsquo;s get rid of them&mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span>month_tokens <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>tibble</span>(month.name) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>unnest_tokens</span>(word, month.name)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tokens <span style=color:#f92672>&lt;-</span> tokens <span style=color:#f92672>%&gt;%</span> <span style=color:#a6e22e>anti_join</span>(month_tokens)
</span></span></code></pre></div><p>&mldr;and see what our chart looks like now</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span>tokens <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>count</span>(word, sort <span style=color:#f92672>=</span> <span style=color:#66d9ef>TRUE</span>) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>filter</span>(n <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>100</span>) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mutate</span>(word <span style=color:#f92672>=</span> <span style=color:#a6e22e>reorder</span>(word, n)) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ggplot</span>(<span style=color:#a6e22e>aes</span>(n, word)) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>geom_col</span>() <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>labs</span>(y <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>)
</span></span></code></pre></div><p>This is better, but there&rsquo;s more we can do. First, let&rsquo;s remove some more words that might clutter our model.</p><p>These calls bring the text of bill types and the names of sponsors identified in the original document into the environment.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span>bill_types <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>read.csv</span>(<span style=color:#e6db74>&#34;https://llc.herokuapp.com/summaries.csv?sql=select+distinct+bill_type+from+actions&amp;_size=max&#34;</span>)
</span></span><span style=display:flex><span>sponsors <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>read.csv</span>(<span style=color:#e6db74>&#34;https://llc.herokuapp.com/summaries.csv?sql=select+distinct+sponsor+from+actions+where+sponsor+is+not+null+and+sponsor+%21%3D+%22%22&amp;_size=max&#34;</span>)
</span></span></code></pre></div><p>We can now make that text tokens</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span>bill_type_tokens <span style=color:#f92672>&lt;-</span> bill_types <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>unnest_tokens</span>(word, bill_type)
</span></span><span style=display:flex><span>sponsor_tokens <span style=color:#f92672>&lt;-</span> sponsors <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>unnest_tokens</span>(word, sponsor)
</span></span></code></pre></div><p>and remove them from our corpus.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span>tokens <span style=color:#f92672>&lt;-</span> tokens <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>anti_join</span>(bill_type_tokens) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>anti_join</span>(sponsor_tokens)
</span></span></code></pre></div><p>How does our chart look now?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span>tokens <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>count</span>(word, sort <span style=color:#f92672>=</span> <span style=color:#66d9ef>TRUE</span>) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>filter</span>(n <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>100</span>) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mutate</span>(word <span style=color:#f92672>=</span> <span style=color:#a6e22e>reorder</span>(word, n)) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ggplot</span>(<span style=color:#a6e22e>aes</span>(n, word)) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>geom_col</span>() <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>labs</span>(y <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>)
</span></span></code></pre></div><p>It doesn&rsquo;t look like any change, but we have reduced the number of tokens in our corpus. I think we&rsquo;re in good enough shape to do our topic modeling.</p><h2 id=topic-modeling>Topic Modeling
<a class=anchor href=#topic-modeling>#</a></h2><h3 id=a-document-feature-matrix>A document feature matrix
<a class=anchor href=#a-document-feature-matrix>#</a></h3><p>The <code>stm()</code> function exposed by the <code>stm</code> package can&rsquo;t take our data frame as input. Instead, it needs a <a href=https://en.wikipedia.org/wiki/Document-term_matrix>document-term matrix</a>, in this case in the form of a document-feature matrix, which we create with the <code>tidytext</code> <code>cast_dfm()</code> function.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span>dfm <span style=color:#f92672>&lt;-</span> tokens <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>count</span>(doc_id, word, sort <span style=color:#f92672>=</span> <span style=color:#66d9ef>TRUE</span>) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cast_dfm</span>(doc_id, word, n)
</span></span></code></pre></div><p>We&rsquo;re ready to apply the model! I&rsquo;ve set k, the number of topics, as 48 because there were 48 Senate committees in 74th Congress. The following line of code takes a few minutes to finish executing.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span>model <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>stm</span>(dfm, K <span style=color:#f92672>=</span> <span style=color:#ae81ff>48</span>, init.type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;LDA&#34;</span>, seed <span style=color:#f92672>=</span> <span style=color:#ae81ff>1234</span>, verbose <span style=color:#f92672>=</span> <span style=color:#66d9ef>FALSE</span>)
</span></span></code></pre></div><h3 id=visualization>Visualization
<a class=anchor href=#visualization>#</a></h3><p>Before we can visualize our model with <code>LDAvis</code>, we need to put our document-term matrix into a form that <code>toLDAvis</code>, an <code>stm</code>-provided wrapper around <code>LDAvis</code>, can understand. We do that with the call to <code>convert()</code> below. The call to <code>toLDAvis</code> creates the visualization as a static website and publishes it online.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span>lda <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>convert</span>(x <span style=color:#f92672>=</span> dfm, to <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lda&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ldavis <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>toLDAvis</span>(model, lda<span style=color:#f92672>$</span>documents, R <span style=color:#f92672>=</span> <span style=color:#ae81ff>48</span>,
</span></span><span style=display:flex><span>		   open.browser <span style=color:#f92672>=</span> <span style=color:#a6e22e>interactive</span>(),
</span></span><span style=display:flex><span>		   as.gist <span style=color:#f92672>=</span> <span style=color:#66d9ef>TRUE</span>)
</span></span></code></pre></div><p>You can see the final product <a href=/portfolio/vis.html>here</a>.</p><h2 id=wrapping-up>Wrapping up
<a class=anchor href=#wrapping-up>#</a></h2><p>Poking around in the visualization a little bit, it becomes clear that there&rsquo;s some more refinement of our data we could do, e.g., removing any token with a numeral in it, removing more honorifics than just &ldquo;Mr.&rdquo;, and perhaps removing the names of actions like &ldquo;approve&rdquo;, &ldquo;pass&rdquo;, and &ldquo;refer&rdquo;. That said, I think that this visualization does offer a good sense of the topics under discussion in various Senate committees in the 74th, and creating it was a great skill-building exercise.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#setting-up>Setting Up</a><ul><li><a href=#the-necessary-libraries>The Necessary Libraries</a></li><li><a href=#initializing-spacy>Initializing spaCy</a></li><li><a href=#load-dataset>Load dataset</a></li></ul></li><li><a href=#preprocessing>Preprocessing</a><ul><li><a href=#spacy>spaCy</a></li><li><a href=#getting-the-words-we-want>Getting the words we want</a></li></ul></li><li><a href=#topic-modeling>Topic Modeling</a><ul><li><a href=#a-document-feature-matrix>A document feature matrix</a></li><li><a href=#visualization>Visualization</a></li></ul></li><li><a href=#wrapping-up>Wrapping up</a></li></ul></nav></div></aside></main></body></html>